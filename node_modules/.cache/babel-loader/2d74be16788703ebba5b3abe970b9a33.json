{"remainingRequest":"/Users/serhiirez/Downloads/auth-11-finished/node_modules/babel-loader/lib/index.js!/Users/serhiirez/Downloads/auth-11-finished/node_modules/eslint-loader/index.js??ref--14-0!/Users/serhiirez/Downloads/auth-11-finished/src/store/modules/auth/actions.js","dependencies":[{"path":"/Users/serhiirez/Downloads/auth-11-finished/src/store/modules/auth/actions.js","mtime":1674479728561},{"path":"/Users/serhiirez/Downloads/auth-11-finished/babel.config.js","mtime":1598437344000},{"path":"/Users/serhiirez/Downloads/auth-11-finished/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/serhiirez/Downloads/auth-11-finished/node_modules/babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/serhiirez/Downloads/auth-11-finished/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZXJyb3IuY2F1c2UuanMiOwpsZXQgdGltZXI7CmV4cG9ydCBkZWZhdWx0IHsKICBhc3luYyBsb2dpbihjb250ZXh0LCBwYXlsb2FkKSB7CiAgICByZXR1cm4gY29udGV4dC5kaXNwYXRjaCgnYXV0aCcsIHsKICAgICAgLi4ucGF5bG9hZCwKICAgICAgbW9kZTogJ2xvZ2luJwogICAgfSk7CiAgfSwKICBhc3luYyBzaWdudXAoY29udGV4dCwgcGF5bG9hZCkgewogICAgcmV0dXJuIGNvbnRleHQuZGlzcGF0Y2goJ2F1dGgnLCB7CiAgICAgIC4uLnBheWxvYWQsCiAgICAgIG1vZGU6ICdzaWdudXAnCiAgICB9KTsKICB9LAogIGFzeW5jIGF1dGgoY29udGV4dCwgcGF5bG9hZCkgewogICAgY29uc3QgbW9kZSA9IHBheWxvYWQubW9kZTsKICAgIGxldCB1cmwgPSAnaHR0cHM6Ly9pZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20vdjEvYWNjb3VudHM6c2lnbkluV2l0aFBhc3N3b3JkP2tleT1BSXphU3lEcTRaVkRmNDMyUl8wb0pKWmxFRDFGQmNqVERGWUU0TVknOwogICAgaWYgKG1vZGUgPT09ICdzaWdudXAnKSB7CiAgICAgIHVybCA9ICdodHRwczovL2lkZW50aXR5dG9vbGtpdC5nb29nbGVhcGlzLmNvbS92MS9hY2NvdW50czpzaWduVXA/a2V5PUFJemFTeURxNFpWRGY0MzJSXzBvSkpabEVEMUZCY2pUREZZRTRNWSc7CiAgICB9CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwgewogICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoewogICAgICAgIGVtYWlsOiBwYXlsb2FkLmVtYWlsLAogICAgICAgIHBhc3N3b3JkOiBwYXlsb2FkLnBhc3N3b3JkLAogICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlCiAgICAgIH0pCiAgICB9KTsKICAgIGNvbnN0IHJlc3BvbnNlRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKICAgIGlmICghcmVzcG9uc2Uub2spIHsKICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IocmVzcG9uc2VEYXRhLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBhdXRoZW50aWNhdGUuIENoZWNrIHlvdXIgbG9naW4gZGF0YS4nKTsKICAgICAgdGhyb3cgZXJyb3I7CiAgICB9CiAgICBjb25zdCBleHBpcmVzSW4gPSArcmVzcG9uc2VEYXRhLmV4cGlyZXNJbiAqIDEwMDA7CiAgICAvLyBjb25zdCBleHBpcmVzSW4gPSA1MDAwOwogICAgY29uc3QgZXhwaXJhdGlvbkRhdGUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIGV4cGlyZXNJbjsKICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd0b2tlbicsIHJlc3BvbnNlRGF0YS5pZFRva2VuKTsKICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd1c2VySWQnLCByZXNwb25zZURhdGEubG9jYWxJZCk7CiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndG9rZW5FeHBpcmF0aW9uJywgZXhwaXJhdGlvbkRhdGUpOwogICAgdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgY29udGV4dC5kaXNwYXRjaCgnYXV0b0xvZ291dCcpOwogICAgfSwgZXhwaXJlc0luKTsKICAgIGNvbnRleHQuY29tbWl0KCdzZXRVc2VyJywgewogICAgICB0b2tlbjogcmVzcG9uc2VEYXRhLmlkVG9rZW4sCiAgICAgIHVzZXJJZDogcmVzcG9uc2VEYXRhLmxvY2FsSWQKICAgIH0pOwogIH0sCiAgdHJ5TG9naW4oY29udGV4dCkgewogICAgY29uc3QgdG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndG9rZW4nKTsKICAgIGNvbnN0IHVzZXJJZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1c2VySWQnKTsKICAgIGNvbnN0IHRva2VuRXhwaXJhdGlvbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd0b2tlbkV4cGlyYXRpb24nKTsKICAgIGNvbnN0IGV4cGlyZXNJbiA9ICt0b2tlbkV4cGlyYXRpb24gLSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgIGlmIChleHBpcmVzSW4gPCAwKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgIGNvbnRleHQuZGlzcGF0Y2goJ2F1dG9Mb2dvdXQnKTsKICAgIH0sIGV4cGlyZXNJbik7CiAgICBpZiAodG9rZW4gJiYgdXNlcklkKSB7CiAgICAgIGNvbnRleHQuY29tbWl0KCdzZXRVc2VyJywgewogICAgICAgIHRva2VuOiB0b2tlbiwKICAgICAgICB1c2VySWQ6IHVzZXJJZAogICAgICB9KTsKICAgIH0KICB9LAogIGxvZ291dChjb250ZXh0KSB7CiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgndG9rZW4nKTsKICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCd1c2VySWQnKTsKICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCd0b2tlbkV4cGlyYXRpb24nKTsKICAgIGNsZWFyVGltZW91dCh0aW1lcik7CiAgICBjb250ZXh0LmNvbW1pdCgnc2V0VXNlcicsIHsKICAgICAgdG9rZW46IG51bGwsCiAgICAgIHVzZXJJZDogbnVsbAogICAgfSk7CiAgfSwKICBhdXRvTG9nb3V0KGNvbnRleHQpIHsKICAgIGNvbnRleHQuZGlzcGF0Y2goJ2xvZ291dCcpOwogICAgY29udGV4dC5jb21taXQoJ3NldEF1dG9Mb2dvdXQnKTsKICB9Cn07"},{"version":3,"names":["timer","login","context","payload","dispatch","mode","signup","auth","url","response","fetch","method","body","JSON","stringify","email","password","returnSecureToken","responseData","json","ok","error","Error","message","expiresIn","expirationDate","Date","getTime","localStorage","setItem","idToken","localId","setTimeout","commit","token","userId","tryLogin","getItem","tokenExpiration","logout","removeItem","clearTimeout","autoLogout"],"sources":["/Users/serhiirez/Downloads/auth-11-finished/src/store/modules/auth/actions.js"],"sourcesContent":["let timer;\n\nexport default {\n  async login(context, payload) {\n    return context.dispatch('auth', {\n      ...payload,\n      mode: 'login'\n    });\n  },\n  async signup(context, payload) {\n    return context.dispatch('auth', {\n      ...payload,\n      mode: 'signup'\n    });\n  },\n  async auth(context, payload) { \n    const mode = payload.mode;\n    let url =\n      'https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=AIzaSyDq4ZVDf432R_0oJJZlED1FBcjTDFYE4MY';\n\n    if (mode === 'signup') {\n      url =\n        'https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=AIzaSyDq4ZVDf432R_0oJJZlED1FBcjTDFYE4MY';\n    }\n    const response = await fetch(url, {\n      method: 'POST',\n      body: JSON.stringify({\n        email: payload.email,\n        password: payload.password,\n        returnSecureToken: true\n      })\n    });\n\n    const responseData = await response.json();\n\n    if (!response.ok) {\n      const error = new Error(\n        responseData.message || 'Failed to authenticate. Check your login data.'\n      );\n      throw error;\n    }\n\n    const expiresIn = +responseData.expiresIn * 1000;\n    // const expiresIn = 5000;\n    const expirationDate = new Date().getTime() + expiresIn;\n\n    localStorage.setItem('token', responseData.idToken);\n    localStorage.setItem('userId', responseData.localId);\n    localStorage.setItem('tokenExpiration', expirationDate);\n\n    timer = setTimeout(function() {\n      context.dispatch('autoLogout');\n    }, expiresIn);\n\n    context.commit('setUser', {\n      token: responseData.idToken,\n      userId: responseData.localId\n    });\n  },\n  tryLogin(context) {\n    const token = localStorage.getItem('token');\n    const userId = localStorage.getItem('userId');\n    const tokenExpiration = localStorage.getItem('tokenExpiration');\n\n    const expiresIn = +tokenExpiration - new Date().getTime();\n\n    if (expiresIn < 0) {\n      return;\n    }\n\n    timer = setTimeout(function() {\n      context.dispatch('autoLogout');\n    }, expiresIn);\n\n    if (token && userId) {\n      context.commit('setUser', {\n        token: token,\n        userId: userId\n      });\n    }\n  },\n  logout(context) {\n    localStorage.removeItem('token');\n    localStorage.removeItem('userId');\n    localStorage.removeItem('tokenExpiration');\n\n    clearTimeout(timer);\n\n    context.commit('setUser', {\n      token: null,\n      userId: null\n    });\n  },\n  autoLogout(context) {\n    context.dispatch('logout');\n    context.commit('setAutoLogout');\n  }\n};\n"],"mappings":"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"}]}